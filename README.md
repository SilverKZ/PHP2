# php2
## Курс «PHP-2: Профессиональное программирование»

### Задание 1-го урока (Модели данных и ООП)
* В качестве основы своего проекта возьмите то, что сделано нами на уроке. Прочтите внимательно код, еще раз повторите, как он работает. 
* Улучшите класс Db.
Во-первых сократите код в методе query(), отвечающий за преобразование данных в объекты нужного класса до одной строчки (читайте руководство по PDO, чтобы понять, как это сделать!)
Во-вторых добавьте в этот метод возможность передать подстановки в запрос.
И в-третьих, сейчас мы написали только метод query(), предназначенный для выполнения запросов, возвращающих данные. Напишите еще один метод execute($query, $params=[]), который будет выполнять запросы, не возвращающие данные (например INSERT, UPDATE) и возвращать лишь true/false в зависимости от того, удачно ли выполнился запрос. 
* Протестируйте работу нового метода, для чего заведите в проекте папку tests и в ней размещайте скрипты, которые наглядно докажут работоспособность вашего кода.
* В абстрактной модели добавьте метод public static function findById($id). Он должен вернуть ОДНУ запись из таблицы данной модели, с указанным первичным ключом. Или false, если таковой записи не нашлось.
* Сделайте таблицу новостей. Добавьте в нее 3-4 новости. На главной странице сайта (index.php) сделайте вывод 3 последних новостей. Используйте модель Article для получения данных (возможно, вам придется добавить какой-то еще метод в эту модель). Для передачи данных в шаблон - просто include файла с шаблоном.
* Каждая новость на главной странице должна быть снабжена ссылкой на страницу /article.php?id=NNN, где NNN - номер этой новости. Разработайте полностью страницу article.php

### Задание 2-го урока (Продолжение разговора о моделях)
* Добавьте в свое приложение класс App\Config. Объект этого класса при создании должен читать и сохранять в себе файл конфигурации. Его применение:
$config = new \App\Config;
echo $config->data['db']['host'];
// пусть это пока коряво смотрится, но по-другому мы еще не умеем
* Если на уроке изучали метод insert(), то продумайте и реализуйте метод update(). Его задача - обновить поля модели, которая ранее была получена из базы данных. Используйте поле id для понимания того, какую запись нужно обновлять!
* Если же уже изучили update() - напишите метод insert(). Он вставляет в базу данных новую запись, основываясь на данных объекта. Не забудьте, что после успешной вставки вы должны заполнить свойство id объекта!
* Реализуйте метод save(), который решит - "новая" модель или нет и, в зависимости от этого, вызовет либо insert(), либо update().
* Добавьте к моделям метод delete()
* На базе реализованного вами кода сделайте простейшую (!) админ-панель новостей с функциями добавления, удаления и редактирования новости.
* Изучите что такое синглтон (слайды + консультация в чате поддержки) и сделайте класс App\Config синглтоном.

### Задание 3-го урока (Изоляция уровня представления)
* Повторите код, изученный на уроке. Выделите ту часть, которая управляет установкой и чтением произвольных свойств объекта в трейт. Не забудьте добавить реализацию метода __isset().
* Добавьте к своим данным еще одну таблицу - авторы новостей (authors). В таблице новостей, соответственно, добавите поле author_id. Модифицируйте модель новостей следующим образом:
Если запрашивается поле ->author, то сначала проверяем поле ->author_id
Если оно не пусто - делаем запрос к таблице authors и возвращаем результат в виде объекта класса Author
Не забудьте снабдить модели соответствующим PHPDoc.
* Измените шаблоны своего приложения, добавьте везде вывод авторов новостей
* Изучите интерфейсы Countable и Iterator и реализуйте его в своем приложении в классе View

### Задание 4-го урока (Контроллеры и фронт-контроллер)
* Напишите класс базового контроллера. Добавьте в него метод-диспетчер вызова действия.
Этот метод должен делать следующее:
Вызвать метод access() контроллера. Если получен результат false - вывести сообщение "Доступ закрыт" и прекратить работу
Вызвать действие
* Создайте контроллеры для клиентских страниц новостей ("все новости", "одна новость") и для админ-панели ("все новости", "редактирование", "сохранение")
* Продумайте систему адресов. Например так: index.php?ctrl=CTRL&act=ACT, где СTRL - имя контроллера, ACT - имя экшна. Напишите фронт-контроллер в соответствии с этой системой адресов.
* Подумайте - не сделать ли для админ-панели другую точку входа? А может быть другой базовый контроллер? Если решите, что это обоснованно - сделайте.
* Создайте систему ЧПУ. Адрес вида /XXX/YYY/ZZZ должен транслироваться в контроллер XXX\YYY (вложенность пространств имен неограничена) и действие ZZZ

### Задание 5-го урока (Исключения)
* Добавьте в свой проект класс исключений, возникающих при работе с базой данных. Придумайте - где их можно бросать? Как вариант - нет соединения с БД, ошибка в запросе.
* Ловите исключения из пункта 1 во фронт-контроллере, поймав же, выдавайте пользователю красивую страницу с сообщением об ошибке.
* Добавьте класс исключений, означающих "Ошибка 404 - не найдено". Бросайте такое исключение в ситуациях, когда вы не можете найти в базе запрашиваемую запись. Добавьте обработку исключений этого типа во фронт-контроллер.
* Добавьте в базовую модель метод fill(array $data), который заполняет свойства модели данными из массива, валидируя их. Примените в этом методе паттерн "Мультиисключение".
* Добавьте в свой проект класс-логгер. Его задача - записывать в текстовый лог информацию об ошибках - когда и где возникла ошибка, какая. Логируйте исключения из пунктов 1 и 3.
